<?xml version="1.0"?>
<sdf version="1.6">
<world name="assembly_mobile_manipulation_door">

  <!-- Floor -->
  <include>
    <uri>file://../models/objects_scenes/floor.sdf</uri>
  </include>

  <!-- ====================================================== -->
  <!-- Mobile Base () -->
  <!-- ====================================================== -->
  <model name="mobile_base">
    <static>false</static>
    <pose>0 0 0.1 0 0 0</pose>

    <link name="base_link">
      <inertial>
        <mass>8.0</mass>
        <inertia>
          <ixx>0.08</ixx><iyy>0.08</iyy><izz>0.12</izz>
        </inertia>
      </inertial>

      <collision name="collision">
        <geometry><box><size>0.4 0.3 0.1</size></box></geometry>
        <drake:proximity_properties>
          <drake:mu_dynamic>0.8</drake:mu_dynamic>
          <drake:mu_static>0.8</drake:mu_static>
        </drake:proximity_properties>
      </collision>

      <visual name="visual">
        <geometry><box><size>0.4 0.3 0.1</size></box></geometry>
        <material><diffuse>0.3 0.3 0.3 1</diffuse></material>
      </visual>

      <!-- Fake omni-wheels (visual only) -->
      <visual name="omni_front_left">
        <pose>0.18 0.13 -0.05 0 0 0</pose>
        <geometry><sphere><radius>0.05</radius></sphere></geometry>
        <material><diffuse>0.05 0.05 0.05 1</diffuse></material>
      </visual>
      <visual name="omni_front_right">
        <pose>0.18 -0.13 -0.05 0 0 0</pose>
        <geometry><sphere><radius>0.05</radius></sphere></geometry>
        <material><diffuse>0.05 0.05 0.05 1</diffuse></material>
      </visual>
      <visual name="omni_rear_left">
        <pose>-0.18 0.13 -0.05 0 0 0</pose>
        <geometry><sphere><radius>0.05</radius></sphere></geometry>
        <material><diffuse>0.05 0.05 0.05 1</diffuse></material>
      </visual>
      <visual name="omni_rear_right">
        <pose>-0.18 -0.13 -0.05 0 0 0</pose>
        <geometry><sphere><radius>0.05</radius></sphere></geometry>
        <material><diffuse>0.05 0.05 0.05 1</diffuse></material>
      </visual>
    </link>

    <!-- Planar mobility joints (x, y, yaw) -->
    <link name="x_link"/>
    <link name="y_link"/>

    <joint name="base_slide_x" type="prismatic">
      <parent>world</parent><child>x_link</child>
      <axis><xyz>1 0 0</xyz><dynamics><damping>1.0</damping></dynamics></axis>
    </joint>
    <joint name="base_slide_y" type="prismatic">
      <parent>x_link</parent><child>y_link</child>
      <axis><xyz>0 1 0</xyz><dynamics><damping>1.0</damping></dynamics></axis>
    </joint>
    <joint name="base_yaw" type="revolute">
      <parent>y_link</parent><child>base_link</child>
      <axis><xyz>0 0 1</xyz><dynamics><damping>0.5</damping></dynamics></axis>
    </joint>
  </model>

  <!-- Panda Arm -->
  <include>
    <uri>file://../models/descriptions/robots/arms/franka_description/urdf/panda_arm_hand.urdf</uri>
    <name>panda</name>
    <pose>0 0 0.15 0 0 1.57</pose>
  </include>
  <joint name="panda_to_mobile_base" type="fixed">
    <parent>mobile_base::base_link</parent>
    <child>panda::panda_link0</child>
  </joint>

  <!-- ====================================================== -->
  <!-- Doorway Assembly -->
  <!-- ====================================================== -->
  <model name="doorway">
    <static>false</static>
    <pose>1.0 0.0 0.02 0 0 0</pose>

    <!-- Door -->
    <link name="door_panel">
      <pose>-0.10 0 1.01 0 0 0</pose>
      <inertial><mass>25.0</mass>
        <inertia><ixx>1.0</ixx><iyy>2.2</iyy><izz>2.2</izz></inertia>
      </inertial>
      <collision name="door_collision">
        <geometry><box><size>0.04 1.0 2.0</size></box></geometry>
        <drake:proximity_properties>
          <drake:mu_dynamic>0.6</drake:mu_dynamic>
          <drake:mu_static>0.6</drake:mu_static>
        </drake:proximity_properties>
      </collision>
      <visual name="door_visual">
        <geometry><box><size>0.04 1.0 2.0</size></box></geometry>
        <material><diffuse>0.7 0.45 0.25 1.0</diffuse></material>
      </visual>

      <!-- Handle on robot side -->
      <visual name="handle_visual">
        <pose>-0.03 0.45 -0.26 0 0 0</pose>
        <geometry><box><size>0.04 0.10 0.04</size></box></geometry>
        <material><diffuse>0.9 0.9 0.2 1.0</diffuse></material>
      </visual>
      <collision name="handle_collision">
        <pose>-0.03 0.45 -0.26 0 0 0</pose>
        <geometry><box><size>0.04 0.10 0.04</size></box></geometry>
      </collision>
    </link>

    <!-- Left wall -->
    <link name="wall_left">
      <pose>0 -0.625 1.1 0 0 0</pose>
      <collision name="wall_collision_left">
        <geometry><box><size>0.15 0.60 2.2</size></box></geometry>
      </collision>
      <visual name="wall_visual_left">
        <geometry><box><size>0.15 0.60 2.2</size></box></geometry>
        <material><diffuse>0.85 0.85 0.85 1</diffuse></material>
      </visual>
    </link>

    <!-- Right wall -->
    <link name="wall_right">
      <pose>0 0.625 1.1 0 0 0</pose>
      <collision name="wall_collision_right">
        <geometry><box><size>0.15 0.60 2.2</size></box></geometry>
      </collision>
      <visual name="wall_visual_right">
        <geometry><box><size>0.15 0.60 2.2</size></box></geometry>
        <material><diffuse>0.85 0.85 0.85 1</diffuse></material>
      </visual>
    </link>

    <!-- Top lintel -->
    <link name="wall_top">
      <pose>0 0 2.2 0 0 0</pose>
      <collision name="wall_collision_top">
        <geometry><box><size>0.15 1.30 0.20</size></box></geometry>
      </collision>
      <visual name="wall_visual_top">
        <geometry><box><size>0.15 1.30 0.20</size></box></geometry>
        <material><diffuse>0.85 0.85 0.85 1</diffuse></material>
      </visual>
    </link>

    <!-- Door hinge -->
    <joint name="door_hinge" type="revolute">
      <parent>wall_left</parent>
      <child>door_panel</child>
      <pose>-0.10 -0.625 1.01 0 0 0</pose>
      <axis>
        <xyz>0 0 1</xyz>
        <limit><lower>0</lower><upper>1.57</upper></limit>
        <dynamics><damping>3.0</damping></dynamics>
      </axis>
    </joint>

    <!-- Fix walls -->
    <joint name="wall_left_fixed" type="fixed">
      <parent>world</parent><child>wall_left</child>
    </joint>
    <joint name="wall_right_fixed" type="fixed">
      <parent>world</parent><child>wall_right</child>
    </joint>
    <joint name="wall_top_fixed" type="fixed">
      <parent>world</parent><child>wall_top</child>
    </joint>
  </model>

</world>
</sdf>
